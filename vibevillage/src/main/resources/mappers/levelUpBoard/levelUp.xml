<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.vibevillage.levelupBoard.mapper.LevelUpMapper">

    <resultMap id="levelResultSet" type="kr.co.vibevillage.levelupBoard.model.LevelUpDTO">
        <result column="lb_no" property="lbNo"></result>
        <result column="lb_title" property="lbTitle"></result>
        <result column="lb_content" property="lbContent"></result>
        <result column="lb_indate" property="lbIndate"></result>
        <result column="lb_update" property="lbUpdate"></result>
        <result column="lb_delete" property="lbDelete"></result>
        <result column="lb_delete_yn" property="lbDeleteYN"></result>
        <result column="lr_no" property="lrNo"></result>
        <result column="lr_content" property="lrContent"></result>
        <result column="lr_status" property="lrStatus"></result>
        <result column="lr_indate" property="lrIndate"></result>
        <result column="u_no" property="uNo"></result>
        <result column="u_nickName" property="userNickName"></result>
    </resultMap>

    <!-- 등업신청서 목록 -->
    <select id="getLevelUpList" resultMap="levelResultSet">
        select lb.LB_NO, LB_TITLE, LB_CONTENT, LB_INDATE, LR_STATUS, lb.U_NO, uv.u_nickname
        from LEVELUP_BOARD lb
        full join LEVELUP_RESULT_BOARD lrb
        on lb.LB_NO = lrb.LB_NO
        join USER_VIBEVILLAGE uv
        on lb.U_NO = uv.U_NO
        where LB_DELETE_YN = 'N'
    </select>

    <!--등업신청서 작성-->
    <insert id="setLevelUpBoardEnroll" parameterType="kr.co.vibevillage.levelupBoard.model.LevelUpDTO">
        insert into LEVELUP_BOARD (LB_NO, LB_TITLE, LB_CONTENT, LB_INDATE, LB_UPDATE, LB_DELETE, LB_DELETE_YN, U_NO)
        VALUES (LEVELUP_BOARD_SEQ.NEXTVAL, #{lbTitle}, #{lbContent}, SYSDATE, NULL, NULL, 'N', #{uNo})
    </insert>

    <!--등업신청시 생성-->
    <insert id="levelResultBoard">
        insert into LEVELUP_RESULT_BOARD (LR_NO, LR_CONTENT, LR_STATUS, LR_INDATE, LB_NO, U_NO)
        values (LEVELUP_RESULT_BOARD_SEQ.NEXTVAL, #{lrContent}, DEFAULT, SYSDATE, #{lbNo}, #{uNo})
    </insert>

    <!--등업신청서 디테일-->
    <select id="getLevelUpBoardDetail" resultMap="levelResultSet">
        select lr.LB_NO, LB_TITLE, LB_CONTENT, LB_INDATE, lr.U_NO, LR_CONTENT, uv.u_nickname
        from LEVELUP_BOARD lr
        full join LEVELUP_RESULT_BOARD lrb
        on lr.LB_NO = lrb.LB_NO
        join USER_VIBEVILLAGE uv
        on lr.U_NO = uv.U_NO
        where lr.LB_NO = #{lbNo}
    </select>

    <!--등업신청서 수정-->
    <update id="setLevelUpBoardEdit" parameterType="kr.co.vibevillage.levelupBoard.model.LevelUpDTO">
        update LEVELUP_BOARD
        set LB_TITLE = #{lbTitle},
            LB_CONTENT = #{lbContent}
        where LB_NO = #{lbNo}
    </update>

    <!--등업신청서 삭제-->
    <update id="lbDelete" parameterType="kr.co.vibevillage.levelupBoard.model.LevelUpDTO">
        update LEVELUP_BOARD
        set LB_DELETE = default,
            LB_DELETE_YN = 'Y'
        where LB_NO = #{lbNo}
    </update>

    <!--등업-->
    <update id="levelUpXML" parameterType="kr.co.vibevillage.user.model.dto.UserDTO">
        update USER_LEVEL_MANAGEMENT ulm
        set  ULM_LEVEL = '여름'
        where U_NO = #{uNo}
    </update>

    <!--등업신청서 승인-->
    <update id="levelUpApprove" parameterType="kr.co.vibevillage.levelupBoard.model.LevelUpDTO">
        update LEVELUP_RESULT_BOARD lrb
        set LR_STATUS = '완료',
            LR_INDATE = SYSDATE,
            LR_CONTENT = #{lrContent}
        where LB_NO = #{lbNo}
    </update>

</mapper>