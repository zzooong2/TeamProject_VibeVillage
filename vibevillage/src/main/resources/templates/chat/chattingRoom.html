<!DOCTYPE html>
<html lang="ko" dir="ltr">
<head>
  <div th:replace="~{common/head :: head}"></div>
  <link rel="stylesheet" th:href="@{/css/chat/chat.css}">
</head>
<body data-spy="scroll" data-target=".onpage-navigation" data-offset="60">
<main>
  <div class="page-loader">
    <div class="loader">로딩 중...</div>
  </div>

  <div th:replace="~{common/nav :: nav}"></div>

  <section class="module-medium">
    <div class="container">
      <div class="unique-chat-container">
        <ul class="unique-chat-thread">
          <li>오늘 만날까요?</li>
          <li>네, 몇 시가 좋으세요?</li>
          <li>오전 회의가 있어서 점심 이후가 좋을 것 같아요.</li>
        </ul>
        <form class="unique-chat-window" onsubmit="sendMessage(event)">
          <input class="unique-chat-window-message" id="chat-window-message" name="chat-window-message" type="text" autocomplete="off" autofocus />
        </form>
      </div>
    </div>
  </section>
  <div class="scroll-up"><a href="#totop"><i class="fa fa-angle-double-up"></i></a></div>
</main>
<div th:replace="~{common/footer :: footer}"></div>
<div th:replace="~{common/js :: js}"></div>
<script th:src="@{/js/chat/chat.js}"></script>
<script>
  var socket = new WebSocket("ws://localhost:8080/chat");

  socket.onmessage = function(event) {
    var chatNewThread = document.createElement('li'),
            chatNewMessage = document.createTextNode(event.data);

    chatNewThread.appendChild(chatNewMessage);
    document.querySelector('.unique-chat-thread').appendChild(chatNewThread);
    document.querySelector('.unique-chat-thread').scrollTop = document.querySelector('.unique-chat-thread').scrollHeight;
  };

  function sendMessage(event) {
    event.preventDefault();
    var input = document.getElementById('chat-window-message');
    if (input.value) {
      socket.send(input.value);
      input.value = '';
    }
  }
</script>
</body>
</html>
